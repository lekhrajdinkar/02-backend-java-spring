# Cloudwatch

## A. Cloudwatch : Metric 
- variable to monitor, some thing on service. 
  - eg: cpu utilization for ec2
- each metric belongs to `namespace`/group
- all service has > `some metric` >  metric has upto 30 attribute(`dimension`)
- can create 
  - `dashboard of metric`
  - `custom metric` on any service.
- can `stream` metric data to:
  - kinesis Data firehose, KDF -> ...
  - 3rd party : `datadog, splunk, dynatrace`

![img.png](../99_img/cw/cw-1/img.png)

---  
## B. Cloudwatch : logs
### Key terms
- `log-group` : create `metric-filter`
- `log-instance` 
- `log-insight`: query engine, insight multiple log-group from same/`diff` acct too.
- log `expiration` policies (never expire, 1 day to 10 yearsâ€¦) 
- logs are `encrypted` by KMS
- Source --> CW:log --> can send to --> destination:
---
### Source : CW logs
- ECS, Lambda, Beanstalk
- VPS flow-logs, R53, API-gateway
- cloudTrail?
- SDK + CW log agent ?
    
### destination : CW logs send to
- Amazon S3 (`CreateExportTask`, take up 12 hr, not real-time)
- Kinesis Data Streams
- Kinesis Data Firehose
- AWS Lambda
- OpenSearch

---    
### Logs streams    
- CW:log-group --> `subscription-filter (destinition) ` --> logs-stream 
- max=2 subscription per log-group.
- subscription-filter : destination:
  - kinesis data stream, KDS
  - kinesis Data Firehose KDF
  - lambda
  - elasticSearch

![img_1.png](../99_img/cw/cw-1/img_1.png)

- aggregate log streams:
  - log-group-1: `subscription filter-1-lg1` --> logs-stream-1  --> destination-1
  - log-group-1: `subscription filter-2-lg1` --> logs-stream-2  --> destination-1
  - log-group-2: `subscription filter-1-lg2` --> logs-stream-3  --> destination-1

![img_2.png](../99_img/cw/cw-1/img_2.png)
  
- cross account subscription 
  - aws1:logs --> aws1:subscription-filter-1(destination-1)
  - destination-1 --> aws2:KDF-1

![img_3.png](../99_img/cw/cw-1/img_3.png)
  
---
## demo
```
- create lambda 
- run multiple time
- lambda "log-group-1" created :
    - log instance-1
    - log instance-2
    
// actions on  log-group-1 :
// 1. export to s3

// 2. create subscription-filter (max=2)
...

// 3. create metric-filter on log-group-1
log-group-1 > metric-filter tab
    - name: filter-1
    - namespace: filter-namespace-1
    - filter pattern : "error"
    - metric value : 100
    - so, when error found in metric will occur with value 100

// 4. create alarm-1 on filter-1
...

```




