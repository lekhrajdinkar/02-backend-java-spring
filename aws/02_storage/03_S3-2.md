# S3 : Security
- At account level can enable/disable `public` flag
- Make Non-public + set `Bucket-policies` (json)
  - json-1: allow/deny : putObject on bucket-1, if condition (sse-XXXX is true)
  - add policy which enforces specific encryption.

## A.Scenarios
- aws1:`iam-principle` --> `aws2`:s3-bucket1/obj-1 : `cross acct access`
- ![img.png](../99_img/storage/s3-1/img.png)
- ![img_1.png](../99_img/storage/s3-1/img_1.png)
- ![img_2.png](../99_img/storage/s3-1/img_2.png)
- ![img_3.png](../99_img/storage/s3-1/img_3.png)

---
## B. ACL
- `Object ACL`
- `bucket ACL`

## C. CORS
- web browser security.
```
// SPA
- server-1(ng:SPA) + server-2(api)
- browser --> server-1
- browser(ng)--> server-2(api) --> response:header:access-control-allow-Origin=server-1

// S3 static website
- bucket-1(index.html) + bucket-2(images, other resource, page-1.html)
- update bucket policy: add getObject for all * prinicple.
- browser --> bucket-1
- browser(index.html) --> ajax::fetch(bucket-2/page-1.html) --> bucket-2 --> will work, only CORS is enabled to bucket-1 as origin 
- bucket-2 > permission tab > edit CORS > add json:origin-bucket-1
```
![img_6.png](../99_img/storage/s3-3/img_6.png)
![img_7.png](../99_img/storage/s3-3/img_7.png)

---
## D. Encryption (v:149,s:309)
- At REST
  - server side encryption, `sse` :
    - `sse-s3` (default) : encryption-key provided/owner by `aws:s3` , http header : "x-amz-server-side-encryption": `AES256`
    - `sse-kms` : encryption-key comes from `kms` ,  http header : "x-amz-server-side-encryption": `aws:kms`
      - client create kms-key before.
      - s3 --> api-call --> KMS (slow)
      - `dsse-kms` came 2023
    - `sse-c` : customer provide key (outside aws)
  client side encryption `cse` : client upload encrypted object
- At transit (TLC/SSL)
  - `http` endpoint
  - `https` endpoint -> update bucket policy : deny http
  - ![img.png](../99_img/storage/s3-3/img.png)

---
# More
## ScreenShot
- ![img_1.png](../99_img/storage/s3-3/img_1.png)
- ![img_2.png](../99_img/storage/s3-3/img_2.png)
- ![img_3.png](../99_img/storage/s3-3/img_3.png)
- ![img_4.png](../99_img/storage/s3-3/img_4.png)
- CORS:
  - ![img_5.png](../99_img/storage/s3-3/img_5.png)