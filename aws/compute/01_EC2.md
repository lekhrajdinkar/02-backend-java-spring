# EC2 / IaaS
- EC2_01: https://chatgpt.com/c/7ddee1bf-7240-4789-913a-72dae8438d00
- EC2_02 : https://chatgpt.com/c/636011e3-1ce6-4268-8089-47ca3b12c9b9

## facts 
- SSH (ec2-linux,mac,W10+) vs  Putty (ec2-W7,8,9) 
- `EC2 instance Connect` (ec2-any instance) : browser session.
- aws cli installed in ec2.
- ** don't run aws configure on ec2 instances.
- rather, attach IAM role to EC2 instance.

## Instance type:
- https://ec2instances.github.io/ [family,version].[size]
- `general purpose` : balanced, eg: t2.micro
- `compute` optimized, c** : gaming server, batch, ML
- `memory` optimized, r**, X** : real-time system, large dataset processing, BI
- `storage` optimized, D**, H1, I3 : File System, data-ware house, cache server, OLTP etc
---
- purchase options:
  - On-Demand Instances – short workload, predictable pricing, pay by second (W and Linux) hour (other OS)
  - `Reserved` (1 & 3 years)
    - Reserved Instances, 72% – long workloads, fixed instance type,OS.
    - `Convertible` Reserved Instances, 66% – long workloads with flexible instances types
  - `Savings` Plans (1 & 3 years) – `commitment` to an amount of usage. Flexible : switch OS, inst type.
  - `Spot Instances` 90% – short workloads, cheap, can lose instances (less reliable), 
    - 2min grace period.
    - spot-block  (1-6 hr), no interruption.
    - Stop request and terminate instance manually then.
    - one time vs persistent.
    - maximun price
  - `Spot fleet` : Spot Instances + optional(On demand)
  - `Dedicated Instances` 
    - no other customers will share your hardware. 
    - VM but underlying h/w not shared with other account.
  - `Dedicated Hosts`
    - most expensive 
    - book an entire physical server/racks/building. 
    - control over instance `placement`
    - pay by : physical cores and underlying network socket visibility.

> `hibernate ec2` : 
>   - whatever in RAM state (< 150 GB), preserved in EBS root volume. hence bootup fast. 
>   - supported by : C**, M** and T** family instances.
>   - max for 60 days
>   - EBS volumn with Encryption must be enabled.

---
## EC2 components
### A. Basic components
- `Tenancy`: host, Dedicated, default
- `SSH` key-Pair
- choose - os / `AMI`. can create image on ec2-i. OS boot volumn : gp* or io*
- memory 
- cpu arch: `ARM or AMD`
- `user-data script` / bootstrap  - (install, update, etc task)
- `Placement group`:
  - `cluster`: same AZ, close-proximity. hence high n/w througput
  - `spread`: different AZ, max 7 instance in each AZ.
  - `partition`: partition/racks in different AZ, max 100

---  
### B. Storage
#### Storage: EC2 instant-store 
- better iops, temp context cache | risk of data loss if h/w fails | manual backup.
#### Storage: EBS
- delete on termination[on/off]
- Network drive, `same AZ`, 
- only volume can be attached to single EC2-i only, multiple volumns assign to same ec2-i,
  - latency due to network.
  - `screenshot` / backups
    - archive (24-72 hrs),  or recycle bin(retention policy)
    - once archived, then create volume out it different AZ. 
  - `encrypt` at rest, both - volume and screenshot using `KMS`
  - perform `capacity planning`, choose below Storage-groups: [ size, iops, throughput/tp]
    - `gp2` : `3 iops per GB` | size defines iops and tp | max- 16TB,    3k  iops, 125 Mbps 
    - `gp3` : `flexible`. configure all 3 independently |  max- 16TB, 3k-16k iops, 1000 Mbps
      - > System boot volumes, Virtual desktops, Development and test environments
    - `io2` : 64K iops | max- 16TB
    - `io3` : 256k iops | max- 64TB | supports -` multi attach`.
      - > databases workloads
    - `HDD` :  max-500 iops | max-500 Mbps
      - > Big Data, Data Warehouses, Log Processing
    - `cold HDD` : max-250 iops | max-250 Mbps
      - > data that is infrequently accessed

#### Storage: EFS
- 3x times expensive than EBS.
- attach to multiple EC2 ( Linux based AMI only)
- `POSIX` file system + standard POXIS API

- Type : `Regional` (span over AZ) and `One-Zone`
- `storage class`
  - lifecycle policy to move between : `standard` >> Infrequent-Access/`EFS-IA`(after n1 days) >> `Archive`((after n2 days)) 50%
- choose performance
  - throughput
    - `bursting ` : scale with size. `mode: general-purpose(R) + max I/O `
    - `enhanced > mode: elastic` : regardless of size, auto-scale with the best performance. (R/recommended)
    - `enhanced > mode: provision` :  manual configure tp
-  max: (auto scale to `Petabyte`-scale) + `3GiB/s for reads` and `1GiB/s for writes`
- choose VPC/subnet >  add security group
- Encryption at rest using KMS + enable/disable automatic backup
- > usecase content management, web serving, data sharing, Wordpress, big data, media processing
- demo:
  ```
  - Create EFS `efs-1` + efs-sg-1
  - Ec2-i1 and i2 : launch instance > attach efs-1
  - choose mount location : /mnt/efs/fs1
  - aws automatically adds sg
      - ec2-i1-sg : inbound rule : Type:NFS, protocol:TCP, port:2049, source:efs-sg-1
      - similary outbound rule.
  - ssh to ec2-i1 and echo "hello" >  /mnt/efs/fs1/hello.txt
  - ssh to ec2-i2 and cat  /mnt/efs/fs1/hello.txt
  ```

---
### C. Network
#### Network: ENI
  - Attach `elastic network card` to Ec2 - `flexible`
  - network fail-over :: if ec2-1 is down >> then launch ec2-2 and attach ENI from old instance to new.
  - bound to AZ.
 
  - contains/defines:
    - speed info, eg 10Gbps
    - `VPC` and subnet
    - one IP public + one MAC address.
    - one private (primary) + many secondary private IP
    - elastic IP
    - Security groups.
    
  - > `elastic-IP` vs  ( random Public IP + DNS ) better vs ELB/LB
    
#### Network: Security group 
  - virtual firewalls / traffic rules(60 max) - eg: allow incoming http, SSH traffic.
  - inbound: all traffic blocked by default.
  - outbound : all traffic allow by default

  - `M2M` : apply multiple(max 5) sg on an ec2 instance, apply same sg2 to multipe ec2 insatnces.
    - EC2 instance-1 has sg-1, sg2,etc
    - EC2 instance-2 has sg-1, sg3,etc
  - `region` specific ( sg + region combination )
  - outside EC2
  - `Stateful`
  - always create new SG for `SSH` (22) 
    - ssh -i "path/to/your-key-file.pem" -p 22 ec2-user@your-ec2-public-dns
    - use keypair over password
  - inbound RULES:
    - Protocol (TCP, UDP, RDP etc)
    - `Source` IP range/CIDR + `another SG`
      - 203.0.113.1/32 (specfic IP)
      - 0.0.0.0/0 (anywhere)
    - `target port` / single or range (target machine which is ec2)
      - classic port: 21,22,80,443, 3389
      - ICMP (Ping)  doesn't use ports
    - outbound RULES:
      - Protocol
      - destination  : IP range/CIDR + `another SG`
      - source port

---
### C. ELB ans ASG
- Elastic load Balancer, Auto Scaling group  : [ELB and ESG](01_ELB_ASG.md)

--- 
## Z. Screenshots
> credit: https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/

![img_2.png](../img/ec2/img_2.png)
![img_1.png](../img/ec2/img_1.png)
![img.png](../img/ec2/img_4.png)
![img_1.png](../img/ec2/img_3.png)


  